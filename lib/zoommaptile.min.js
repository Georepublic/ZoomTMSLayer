/* Copyright (c) 2012 OHTSUKA Ko-hei */
var ZoomingTMS=function(e){if(typeof e=="undefined")throw new Error("Options are required.");if(typeof e.url=="undefined")throw new Error("Url property is required.");if(typeof e.layername=="undefined")throw new Error("Layername property is required.");if(typeof e.tileMaxZoom=="undefined")throw new Error("TileMaxZoom property is required.");for(var t in e)this[t]=e[t]};ZoomingTMS.prototype={maxZoom:null,minZoom:0,tileMaxZoom:null,tileSize:typeof google!="undefined"&&typeof google.maps!="undefined"?new google.maps.Size(256,256):{width:256,height:256},name:"",alt:"",url:null,serviceVersion:"1.0.0",layername:null,type:"png",isTMSYAxis:!1,getTile:function(e,t,n){var r=n.createElement("div");r.style.width=this.tileSize.width+"px",r.style.height=this.tileSize.height+"px",r.style.border="0px";if(this.maxZoom!==null&&t>this.maxZoom||t<this.minZoom)return r=null,null;var i=t-this.tileMaxZoom;i<0&&(i=0);var s=this.isTMSYAxis?e.y:(1<<t)-e.y-1,o={x:e.x,y:s},u=n.createElement("img");u.style.width=this.tileSize.width+"px",u.style.height=this.tileSize.height+"px";var a;if(i>0){var f=Math.pow(2,i),l=256*(f-1)/(f*2),c=256/f,h=o.x%f,p=l-h*c,d=f-o.y%f-1,v=l-d*c;o.x=Math.floor(o.x/f),o.y=Math.floor(o.y/f);var m="scale("+f+","+f+") translate("+p+"px,"+v+"px)";a=n.createElement("div"),a.style.transform=m,a.style.msTransform=m,a.style.webkitTransform=m,a.style.MozTransform=m,a.style.OTransform=m,a.style.border="0px",u.style.clip="rect("+d*c+"px,"+(h+1)*c+"px,"+(d+1)*c+"px,"+h*c+"px)",r.appendChild(a)}else a=r;return u.onload=function(){a.appendChild(u)},u.onerror=function(){r.parentNode&&r.parentNode.removeChild(r),u=null,r=null,a=null},u.src=this.getTileUrl(o,t-i),r},getTileUrl:function(e,t){var n=this.layername+"/"+t+"/"+e.x+"/"+e.y+"."+this.type;return this.serviceVersion!=""&&(n=this.serviceVersion+"/"+n),this.url+n}};
